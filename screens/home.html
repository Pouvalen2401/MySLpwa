<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#4F46E5">
  <title>SignSpeak - Home</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="../css/home.css">
</head>
<body>
  <!-- Header -->
  <header class="header-custom">
    <div class="container-custom">
      <div class="header-content">
        <a href="home.html" class="logo">ü§ü SignSpeak</a>
        
        <nav class="nav-custom">
          <a href="home.html" class="nav-link-custom active">Home</a>
          <a href="translate.html" class="nav-link-custom">Translate</a>
          <a href="profile.html" class="nav-link-custom">Profile</a>
          <button id="settingsBtn" class="btn-icon btn-outline-custom">‚öôÔ∏è</button>
        </nav>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container-custom" style="padding: 32px 20px;">
    <!-- Welcome Section -->
    <section class="welcome-section">
      <div class="card-custom">
        <h1 class="mb-2">Welcome back, <span id="userName">User</span>! üëã</h1>
        <p class="text-muted">Ready to translate some signs?</p>
      </div>
    </section>

    <!-- Quick Actions -->
    <section class="quick-actions mt-4">
      <h2 class="mb-3">Quick Actions</h2>
      
      <div class="row g-3">
        <div class="col-md-6">
          <div class="card-custom action-card" onclick="window.location.href='translate.html?mode=sign-to-text'">
            <div class="action-icon">ü§ü</div>
            <h3>Sign to Text</h3>
            <p class="text-muted">Translate your sign language to text in real-time</p>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card-custom action-card" onclick="window.location.href='translate.html?mode=text-to-sign'">
            <div class="action-icon">‚úçÔ∏è</div>
            <h3>Text to Sign</h3>
            <p class="text-muted">Learn how to sign any text with avatar guidance</p>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card-custom action-card" onclick="window.location.href='avatar-customization.html'">
            <div class="action-icon">üë§</div>
            <h3>Customize Avatar</h3>
            <p class="text-muted">Personalize your avatar appearance</p>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card-custom action-card" onclick="showHistory()">
            <div class="action-icon">üìù</div>
            <h3>Translation History</h3>
            <p class="text-muted">View your recent translations</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Statistics -->
    <section class="statistics mt-4">
      <h2 class="mb-3">Your Progress</h2>
      
      <div class="row g-3">
        <div class="col-md-4">
          <div class="card-custom text-center">
            <div class="stat-number" id="totalTranslations">0</div>
            <div class="stat-label">Total Translations</div>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="card-custom text-center">
            <div class="stat-number" id="todayTranslations">0</div>
            <div class="stat-label">Today</div>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="card-custom text-center">
            <div class="stat-number" id="learnedSigns">0</div>
            <div class="stat-label">Signs Learned</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Recent Activity -->
    <section class="recent-activity mt-4">
      <h2 class="mb-3">Recent Activity</h2>
      
      <div id="recentList" class="card-custom">
        <p class="text-muted text-center">No recent activity</p>
      </div>
    </section>
  </main>

  <!-- History Modal -->
  <div id="historyModal" class="modal" style="display: none;">
    <div class="modal-content card-custom" style="max-width: 600px; margin: 50px auto;">
      <div class="flex justify-between align-center mb-3">
        <h2>Translation History</h2>
        <button onclick="closeHistory()" class="btn-icon">‚úï</button>
      </div>
      
      <div id="historyList" style="max-height: 400px; overflow-y: auto;">
        <!-- History items will be inserted here -->
      </div>
      
      <div class="mt-3 text-center">
        <button onclick="clearAllHistory()" class="btn-outline-custom">Clear All History</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="../js/utils.js"></script>
  <script src="../js/storage-manager.js"></script>
  <script src="../js/settings-manager.js"></script>

  <script>
    let currentUserId = null;

    // Initialize page
    async function init() {
      try {
        // Check if user is logged in
        currentUserId = Utils.getLocalStorage('currentUserId');
        
        if (!currentUserId) {
          window.location.href = '../index.html';
          return;
        }

        // Load user data
        const user = await StorageManager.getUser(currentUserId);
        if (user) {
          document.getElementById('userName').textContent = user.name;
        }

        // Initialize settings
        await SettingsManager.init(currentUserId);

        // Load statistics
        await loadStatistics();

        // Load recent activity
        await loadRecentActivity();

      } catch (error) {
        console.error('Initialization error:', error);
        Utils.showToast('Failed to load data', 'error');
      }
    }

    // Load statistics
    async function loadStatistics() {
      try {
        const history = await StorageManager.getTranslationHistory(currentUserId);
        
        // Total translations
        document.getElementById('totalTranslations').textContent = history.length;

        // Today's translations
        const today = new Date().setHours(0, 0, 0, 0);
        const todayCount = history.filter(t => t.timestamp >= today).length;
        document.getElementById('todayTranslations').textContent = todayCount;

        // Unique signs learned (simplified)
        const uniqueSigns = new Set(history.map(t => t.output)).size;
        document.getElementById('learnedSigns').textContent = uniqueSigns;

      } catch (error) {
        console.error('Failed to load statistics:', error);
      }
    }

    // Load recent activity
    async function loadRecentActivity() {
      try {
        const history = await StorageManager.getTranslationHistory(currentUserId, 5);
        const listContainer = document.getElementById('recentList');

        if (history.length === 0) {
          listContainer.innerHTML = '<p class="text-muted text-center">No recent activity</p>';
          return;
        }

        const html = history.map(item => `
          <div class="activity-item" style="padding: 16px; border-bottom: 1px solid var(--border-light);">
            <div class="flex justify-between align-center">
              <div>
                <div style="font-weight: 600;">${item.output}</div>
                <div class="text-muted" style="font-size: 14px;">
                  ${item.type === 'sign-to-text' ? 'Sign ‚Üí Text' : 'Text ‚Üí Sign'}
                  ${item.mood !== 'neutral' ? ` ‚Ä¢ ${getMoodEmoji(item.mood)}` : ''}
                </div>
              </div>
              <div class="text-muted" style="font-size: 12px;">
                ${Utils.formatTimestamp(item.timestamp)}
              </div>
            </div>
          </div>
        `).join('');

        listContainer.innerHTML = html;

      } catch (error) {
        console.error('Failed to load recent activity:', error);
      }
    }

    // Show history modal
    async function showHistory() {
      try {
        const history = await StorageManager.getTranslationHistory(currentUserId);
        const modal = document.getElementById('historyModal');
        const listContainer = document.getElementById('historyList');

        if (history.length === 0) {
          listContainer.innerHTML = '<p class="text-muted text-center">No translation history</p>';
        } else {
          const html = history.map(item => `
            <div class="activity-item" style="padding: 12px; border-bottom: 1px solid var(--border-light);">
              <div class="flex justify-between">
                <div>
                  <div style="font-weight: 600;">${item.output}</div>
                  <div class="text-muted" style="font-size: 13px;">${item.input}</div>
                  <div class="text-muted" style="font-size: 12px;">
                    ${item.type} ‚Ä¢ ${getMoodEmoji(item.mood)} ${item.mood}
                  </div>
                </div>
                <div class="text-muted" style="font-size: 12px;">
                  ${Utils.formatDate(item.timestamp)}
                </div>
              </div>
            </div>
          `).join('');
          
          listContainer.innerHTML = html;
        }

        modal.style.display = 'block';

      } catch (error) {
        console.error('Failed to load history:', error);
        Utils.showToast('Failed to load history', 'error');
      }
    }

    // Close history modal
    function closeHistory() {
      document.getElementById('historyModal').style.display = 'none';
    }

    // Clear all history
    async function clearAllHistory() {
      if (confirm('Are you sure you want to clear all translation history?')) {
        try {
          await StorageManager.clearTranslationHistory(currentUserId);
          Utils.showToast('History cleared', 'success');
          closeHistory();
          await loadStatistics();
          await loadRecentActivity();
        } catch (error) {
          console.error('Failed to clear history:', error);
          Utils.showToast('Failed to clear history', 'error');
        }
      }
    }

    // Get mood emoji
    function getMoodEmoji(mood) {
      const emojis = {
        happy: 'üòä',
        sad: 'üò¢',
        angry: 'üò†',
        surprised: 'üòÆ',
        fearful: 'üò®',
        disgusted: 'ü§¢',
        neutral: 'üòê'
      };
      return emojis[mood] || 'üòê';
    }

    // Settings button
    document.getElementById('settingsBtn').addEventListener('click', () => {
      window.location.href = 'settings.html';
    });

    // Close modal on background click
    document.getElementById('historyModal').addEventListener('click', (e) => {
      if (e.target.id === 'historyModal') {
        closeHistory();
      }
    });

    // Initialize on load
    window.addEventListener('DOMContentLoaded', init);
  </script>

  <style>
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      overflow-y: auto;
    }

    .action-card {
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      padding: 32px 24px !important;
    }

    .action-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    }

    .action-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .action-card h3 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--primary-color);
    }

    .stat-number {
      font-size: 48px;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 14px;
      color: var(--text-muted-light);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .activity-item:last-child {
      border-bottom: none !important;
    }
  </style>
</body>
</html>